name: Code Quality

on:
    push:
        branches: [main, develop]
    pull_request:
        branches: [main, develop]

jobs:
    code-quality:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Install uv
              uses: astral-sh/setup-uv@v2

            - name: Set up Python
              run: uv venv
              env:
                  VIRTUAL_ENV: .venv

            - name: Sync dependencies
              run: uv sync --all-groups
              env:
                  VIRTUAL_ENV: .venv

            - name: Run ruff lint
              run: uv run ruff check src/ tests/ --output-format=github
              env:
                  VIRTUAL_ENV: .venv
              continue-on-error: true

            - name: Check code formatting
              run: |
                  uv run black src/ tests/ --check --diff
              env:
                  VIRTUAL_ENV: .venv
              continue-on-error: true

            - name: Generate complexity report
              run: |
                  uv run pip install radon
                  uv run radon cc src/ -a -j > complexity-report.json || true
              env:
                  VIRTUAL_ENV: .venv

            - name: Upload complexity report
              uses: actions/upload-artifact@v4
              with:
                  name: complexity-report
                  path: complexity-report.json