name: Update Dependencies

on:
    schedule:
        # Run every Monday at 9 AM UTC
        - cron: "0 9 * * 1"
    workflow_dispatch:

permissions:
    pull-requests: write
    contents: write

jobs:
    update-deps:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Install uv
              uses: astral-sh/setup-uv@v2

            - name: Set up Python
              run: uv venv
              env:
                  VIRTUAL_ENV: .venv

            - name: Update lock file
              run: uv lock --upgrade
              env:
                  VIRTUAL_ENV: .venv

            - name: Check for changes
              id: check
              run: |
                  if git diff --quiet uv.lock; then
                    echo "has_changes=false" >> $GITHUB_OUTPUT
                  else
                    echo "has_changes=true" >> $GITHUB_OUTPUT
                  fi

            - name: Create Pull Request
              if: steps.check.outputs.has_changes == 'true'
              uses: peter-evans/create-pull-request@v5
              with:
                  commit-message: "chore: update dependencies"
                  title: "chore: update dependencies"
                  body: |
                      ## Automated Dependency Update

                      This PR updates the project dependencies to their latest versions.

                      **Changes:**
                      - Updated `uv.lock` with latest package versions
                      - No breaking changes expected

                      Please review and test before merging.
                  branch: "deps/update-dependencies"
                  delete-branch: true
                  labels: "dependencies, automated"
